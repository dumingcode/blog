<svg id="SvgjsSvg1126" width="742.5" height="731" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1127"><marker id="SvgjsMarker1158" markerWidth="16" markerHeight="16" refX="11" refY="8" viewBox="0 0 16 16" orient="auto" markerUnits="userSpaceOnUse"><path id="SvgjsPath1159" d="M0,0 L10,8 L0,16" fill="none" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1174" markerWidth="16" markerHeight="16" refX="11" refY="8" viewBox="0 0 16 16" orient="auto" markerUnits="userSpaceOnUse"><path id="SvgjsPath1175" d="M0,0 L10,8 L0,16" fill="none" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1186" markerWidth="16" markerHeight="16" refX="11" refY="8" viewBox="0 0 16 16" orient="auto" markerUnits="userSpaceOnUse"><path id="SvgjsPath1187" d="M0,0 L10,8 L0,16" fill="none" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1198" markerWidth="16" markerHeight="16" refX="11" refY="8" viewBox="0 0 16 16" orient="auto" markerUnits="userSpaceOnUse"><path id="SvgjsPath1199" d="M0,0 L10,8 L0,16" fill="none" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1214" markerWidth="16" markerHeight="16" refX="11" refY="8" viewBox="0 0 16 16" orient="auto" markerUnits="userSpaceOnUse"><path id="SvgjsPath1215" d="M0,0 L10,8 L0,16" fill="none" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1228" markerWidth="16" markerHeight="16" refX="11" refY="8" viewBox="0 0 16 16" orient="auto" markerUnits="userSpaceOnUse"><path id="SvgjsPath1229" d="M0,0 L10,8 L0,16" fill="none" stroke="#323232" stroke-width="2"></path></marker><marker id="SvgjsMarker1244" markerWidth="16" markerHeight="16" refX="11" refY="8" viewBox="0 0 16 16" orient="auto" markerUnits="userSpaceOnUse"><path id="SvgjsPath1245" d="M0,0 L10,8 L0,16" fill="none" stroke="#323232" stroke-width="2"></path></marker></defs><g id="SvgjsG1128" transform="translate(38.5,83)"><path id="SvgjsPath1129" d="M 0 4Q 0 0 4 0L 110 0Q 114 0 114 4L 114 44Q 114 48 110 48L 4 48Q 0 48 0 44Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1130"><text id="SvgjsText1131" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="81" fill="#323232" font-weight="400" align="middle" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" y="14.05" transform="rotate(0)"><tspan id="SvgjsTspan1132" dy="16" x="57"><tspan id="SvgjsTspan1133" style="text-decoration:;">调用wx.login </tspan></tspan></text></g></g><g id="SvgjsG1134" transform="translate(379.5,78)"><path id="SvgjsPath1135" d="M 0 4Q 0 0 4 0L 201 0Q 205 0 205 4L 205 54Q 205 58 201 58L 4 58Q 0 58 0 54Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1136"><text id="SvgjsText1137" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="183" fill="#323232" font-weight="400" align="middle" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" y="3.05" transform="rotate(0)"><tspan id="SvgjsTspan1138" dy="16" x="102.5"><tspan id="SvgjsTspan1139" style="text-decoration:;">根据code调用WX </tspan></tspan><tspan id="SvgjsTspan1140" dy="16" x="102.5"><tspan id="SvgjsTspan1141" style="text-decoration:;">https://api.weixin.qq.com/sns</tspan></tspan><tspan id="SvgjsTspan1142" dy="16" x="102.5"><tspan id="SvgjsTspan1143" style="text-decoration:;">/jscode2session</tspan></tspan></text></g></g><g id="SvgjsG1144" transform="translate(25.5,32)"><path id="SvgjsPath1145" d="M 0 0L 160 0L 160 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1146"><text id="SvgjsText1147" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="39" fill="#323232" font-weight="700" align="middle" anchor="middle" family="微软雅黑" size="13px" weight="700" font-style="" y="10.05" transform="rotate(0)"><tspan id="SvgjsTspan1148" dy="16" x="80"><tspan id="SvgjsTspan1149" style="text-decoration:;">小程序</tspan></tspan></text></g></g><g id="SvgjsG1150" transform="translate(398.5,25)"><path id="SvgjsPath1151" d="M 0 0L 160 0L 160 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1152"><text id="SvgjsText1153" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="52" fill="#323232" font-weight="700" align="middle" anchor="middle" family="微软雅黑" size="13px" weight="700" font-style="" y="10.05" transform="rotate(0)"><tspan id="SvgjsTspan1154" dy="16" x="80"><tspan id="SvgjsTspan1155" style="text-decoration:;">后端服务</tspan></tspan></text></g></g><g id="SvgjsG1156"><path id="SvgjsPath1157" d="M152.5 107L379.5 107" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1158)"></path><rect id="SvgjsRect1160" width="99" height="16" x="216.5" y="99" fill="#ffffff"></rect><text id="SvgjsText1161" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="99" fill="#323232" font-weight="400" align="top" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" y="97.05" transform="rotate(0)"><tspan id="SvgjsTspan1162" dy="16" x="266"><tspan id="SvgjsTspan1163" style="text-decoration:;">获得wx返回code</tspan></tspan></text></g><g id="SvgjsG1164" transform="translate(379.5,179)"><path id="SvgjsPath1165" d="M 0 0L 205 0L 205 73L 0 73Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1166"><text id="SvgjsText1167" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="181" fill="#323232" font-weight="400" align="middle" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" y="18.55" transform="rotate(0)"><tspan id="SvgjsTspan1168" dy="16" x="102.5"><tspan id="SvgjsTspan1169" style="text-decoration:;">获得wx openid并与本地用户做</tspan></tspan><tspan id="SvgjsTspan1170" dy="16" x="102.5"><tspan id="SvgjsTspan1171" style="text-decoration:;">绑定（保存新登录用户）</tspan></tspan></text></g></g><g id="SvgjsG1172"><path id="SvgjsPath1173" d="M482 136L482 179" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1174)"></path></g><g id="SvgjsG1176" transform="translate(376.5,296)"><path id="SvgjsPath1177" d="M 0 4Q 0 0 4 0L 207 0Q 211 0 211 4L 211 60Q 211 64 207 64L 4 64Q 0 64 0 60Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1178"><text id="SvgjsText1179" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="170" fill="#323232" font-weight="400" align="middle" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" y="14.05" transform="rotate(0)"><tspan id="SvgjsTspan1180" dy="16" x="105.5"><tspan id="SvgjsTspan1181" style="text-decoration:;">将local userid  进行加密生成</tspan></tspan><tspan id="SvgjsTspan1182" dy="16" x="105.5"><tspan id="SvgjsTspan1183" style="text-decoration:;">token</tspan></tspan></text></g></g><g id="SvgjsG1184"><path id="SvgjsPath1185" d="M482 252L482 296" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1186)"></path></g><g id="SvgjsG1188" transform="translate(28.5,391)"><path id="SvgjsPath1189" d="M 0 4Q 0 0 4 0L 130 0Q 134 0 134 4L 134 57Q 134 61 130 61L 4 61Q 0 61 0 57Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1190"><text id="SvgjsText1191" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="104" fill="#323232" font-weight="400" align="middle" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" y="12.55" transform="rotate(0)"><tspan id="SvgjsTspan1192" dy="16" x="67"><tspan id="SvgjsTspan1193" style="text-decoration:;">wx小程序将token</tspan></tspan><tspan id="SvgjsTspan1194" dy="16" x="67"><tspan id="SvgjsTspan1195" style="text-decoration:;">保存在本地</tspan></tspan></text></g></g><g id="SvgjsG1196"><path id="SvgjsPath1197" d="M482 360L162.5 421.5" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1198)"></path><rect id="SvgjsRect1200" width="101" height="16" x="271.75" y="382.75" fill="#ffffff"></rect><text id="SvgjsText1201" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="101" fill="#323232" font-weight="400" align="top" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" y="380.8" transform="rotate(0)"><tspan id="SvgjsTspan1202" dy="16" x="322.25"><tspan id="SvgjsTspan1203" style="text-decoration:;">token返回小程序</tspan></tspan></text></g><g id="SvgjsG1204" transform="translate(25,513)"><path id="SvgjsPath1205" d="M 0 4Q 0 0 4 0L 137 0Q 141 0 141 4L 141 67Q 141 71 137 71L 4 71Q 0 71 0 67Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1206"><text id="SvgjsText1207" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="88" fill="#323232" font-weight="400" align="middle" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" y="17.55" transform="rotate(0)"><tspan id="SvgjsTspan1208" dy="16" x="70.5"><tspan id="SvgjsTspan1209" style="text-decoration:;">将token添加到</tspan></tspan><tspan id="SvgjsTspan1210" dy="16" x="70.5"><tspan id="SvgjsTspan1211" style="text-decoration:;">httpheader中</tspan></tspan></text></g></g><g id="SvgjsG1212"><path id="SvgjsPath1213" d="M95.5 452L95.5 513" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1214)"></path></g><g id="SvgjsG1216" transform="translate(384.5,513)"><path id="SvgjsPath1217" d="M 0 4Q 0 0 4 0L 203 0Q 207 0 207 4L 207 67Q 207 71 203 71L 4 71Q 0 71 0 67Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1218"><text id="SvgjsText1219" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="168" fill="#323232" font-weight="400" align="middle" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" y="9.55" transform="rotate(0)"><tspan id="SvgjsTspan1220" dy="16" x="103.5"><tspan id="SvgjsTspan1221" style="text-decoration:;">http filter中将header中的</tspan></tspan><tspan id="SvgjsTspan1222" dy="16" x="103.5"><tspan id="SvgjsTspan1223" style="text-decoration:;">token解密，将解密出的local </tspan></tspan><tspan id="SvgjsTspan1224" dy="16" x="103.5"><tspan id="SvgjsTspan1225" style="text-decoration:;">userid 放到session中</tspan></tspan></text></g></g><g id="SvgjsG1226"><path id="SvgjsPath1227" d="M166 548.5L384.5 548.5" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1228)"></path><rect id="SvgjsRect1230" width="47" height="16" x="251.75" y="540.5" fill="#ffffff"></rect><text id="SvgjsText1231" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="47" fill="#323232" font-weight="400" align="top" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" y="538.55" transform="rotate(0)"><tspan id="SvgjsTspan1232" dy="16" x="275.25"><tspan id="SvgjsTspan1233" style="text-decoration:;">API调用</tspan></tspan></text></g><g id="SvgjsG1234" transform="translate(381.5,638)"><path id="SvgjsPath1235" d="M 0 4Q 0 0 4 0L 209 0Q 213 0 213 4L 213 64Q 213 68 209 68L 4 68Q 0 68 0 64Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1236"><text id="SvgjsText1237" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="188" fill="#323232" font-weight="400" align="middle" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" y="16.05" transform="rotate(0)"><tspan id="SvgjsTspan1238" dy="16" x="106.5"><tspan id="SvgjsTspan1239" style="text-decoration:;">后续业务逻辑中就根据session中</tspan></tspan><tspan id="SvgjsTspan1240" dy="16" x="106.5"><tspan id="SvgjsTspan1241" style="text-decoration:;">的userid返回数据</tspan></tspan></text></g></g><g id="SvgjsG1242"><path id="SvgjsPath1243" d="M488 584L488 638" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1244)"></path></g><g id="SvgjsG1246" transform="translate(594.5,91)"><path id="SvgjsPath1247" d="M 0 249Q 9 249 9 240L 9 133.5Q 9 124.5 22 124.5Q 9 124.5 9 115.5L 9 9Q 9 0 0 0" stroke="#323232" stroke-width="2" fill="none"></path><path id="SvgjsPath1248" d="M 0 0L 123 0L 123 249L 0 249Z" stroke="none" fill="none"></path><g id="SvgjsG1249"><text id="SvgjsText1250" font-family="微软雅黑" text-anchor="start" font-size="13px" width="78" fill="#323232" font-weight="400" align="middle" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" y="106.55" transform="rotate(0)"><tspan id="SvgjsTspan1251" dy="16" x="27"><tspan id="SvgjsTspan1252" style="text-decoration:;">封装在同一个</tspan></tspan><tspan id="SvgjsTspan1253" dy="16" x="27"><tspan id="SvgjsTspan1254" style="text-decoration:;">API接口中</tspan></tspan></text></g></g></svg>